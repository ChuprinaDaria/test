# API Endpoints –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

## –ë–∞–∑–æ–≤–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

**Base URL:** `http://localhost:8000/api` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
**–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:** –∑–º—ñ–Ω–Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è `VITE_API_URL`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è:** Bearer Token —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer {access_token}`
–¢–æ–∫–µ–Ω –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ `localStorage` —è–∫ `access_token`

---

## üîê Authentication API (`/auth/`)

### 1. –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/auth/register/`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:**
```json
{
  "email": "string",
  "password": "string",
  "salon_name": "string"
}
```
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "access": "string",
  "refresh": "string",
  "user": {
    "id": 1,
    "email": "string",
    "salon_name": "string",
    "is_trial": true,
    "trial_end_date": "2024-01-01T00:00:00Z"
  }
}
```

### 2. –õ–æ–≥—ñ–Ω
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/auth/login/`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:**
```json
{
  "email": "string",
  "password": "string"
}
```
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:** (—Ç–∞–∫–∞ –∂ —è–∫ —É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó)
```json
{
  "access": "string",
  "refresh": "string",
  "user": {
    "id": 1,
    "email": "string",
    "salon_name": "string",
    "is_trial": true,
    "trial_end_date": "2024-01-01T00:00:00Z"
  }
}
```

### 3. –í–∏—Ö—ñ–¥
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/auth/logout/`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:** (–ø–æ—Ä–æ–∂–Ω—î, –∞–±–æ refresh token)
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:** `200 OK`

### 4. –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å
- **–ú–µ—Ç–æ–¥:** `GET`
- **URL:** `/auth/me/`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "id": 1,
  "email": "string",
  "salon_name": "string",
  "is_trial": true,
  "trial_end_date": "2024-01-01T00:00:00Z"
}
```

### 5. –û–Ω–æ–≤–∏—Ç–∏ —Ç–æ–∫–µ–Ω
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/auth/refresh/`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:**
```json
{
  "refresh": "string"
}
```
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "access": "string"
}
```

---

## ü§ñ Agent API (`/agent/`)

### Files (–§–∞–π–ª–∏ –¥–ª—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è)

#### 1. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/agent/files/`
- **Content-Type:** `multipart/form-data`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:** FormData –∑ –ø–æ–ª–µ–º `file`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "id": 1,
  "name": "string",
  "size": 1024,
  "type": "string",
  "uploaded_at": "2024-01-01T00:00:00Z"
}
```

#### 2. –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª—ñ–≤
- **–ú–µ—Ç–æ–¥:** `GET`
- **URL:** `/agent/files/`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
[
  {
    "id": 1,
    "name": "string",
    "size": 1024,
    "type": "string",
    "uploaded_at": "2024-01-01T00:00:00Z"
  }
]
```

#### 3. –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª
- **–ú–µ—Ç–æ–¥:** `DELETE`
- **URL:** `/agent/files/{fileId}/`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:** `200 OK` –∞–±–æ `204 No Content`

### Prompt (–°–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç)

#### 4. –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç
- **–ú–µ—Ç–æ–¥:** `GET`
- **URL:** `/agent/prompt/`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "prompt": "string"
}
```

#### 5. –û–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–º–ø—Ç
- **–ú–µ—Ç–æ–¥:** `PUT`
- **URL:** `/agent/prompt/`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:**
```json
{
  "prompt": "string"
}
```
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "prompt": "string"
}
```

### Training (–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ)

#### 6. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/agent/train/`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:** (–ø–æ—Ä–æ–∂–Ω—î)
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "status": "started",
  "message": "Training started"
}
```

#### 7. –°—Ç–∞—Ç—É—Å —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è
- **–ú–µ—Ç–æ–¥:** `GET`
- **URL:** `/agent/train/status/`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "status": "idle" | "training" | "completed" | "failed",
  "progress": 0.5,
  "message": "string"
}
```

### Testing (–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —á–∞—Ç—É)

#### 8. –¢–µ—Å—Ç–æ–≤–∏–π —á–∞—Ç
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/agent/test/`
- **Content-Type:** `multipart/form-data`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:** FormData –∑ –ø–æ–ª—è–º–∏:
  - `message`: string (–æ–±–æ–≤'—è–∑–∫–æ–≤–µ)
  - `photo`: File (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–µ)
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "response": "string",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### History (–Ü—Å—Ç–æ—Ä—ñ—è —á–∞—Ç—ñ–≤)

#### 9. –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é —á–∞—Ç—ñ–≤
- **–ú–µ—Ç–æ–¥:** `GET`
- **URL:** `/agent/history/`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
[
  {
    "id": 1,
    "customer_name": "string",
    "last_message": "string",
    "timestamp": "2024-01-01T00:00:00Z",
    "unread": 0
  }
]
```

#### 10. –î–µ—Ç–∞–ª—ñ —á–∞—Ç—É
- **–ú–µ—Ç–æ–¥:** `GET`
- **URL:** `/agent/history/{chatId}/`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "id": 1,
  "customer_name": "string",
  "messages": [
    {
      "id": 1,
      "text": "string",
      "sender": "customer" | "ai",
      "timestamp": "2024-01-01T00:00:00Z"
    }
  ]
}
```

---

## üîå Integrations API (`/integrations/`)

#### 1. –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
- **–ú–µ—Ç–æ–¥:** `GET`
- **URL:** `/integrations/`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
[
  {
    "id": 1,
    "type": "telegram" | "whatsapp" | "calendar",
    "status": "connected" | "disconnected",
    "connected_at": "2024-01-01T00:00:00Z"
  }
]
```

#### 2. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ Telegram
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/integrations/telegram/`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:**
```json
{
  "token": "string"
}
```
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "id": 1,
  "type": "telegram",
  "status": "connected",
  "connected_at": "2024-01-01T00:00:00Z"
}
```

#### 3. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ WhatsApp
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/integrations/whatsapp/`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:**
```json
{
  "phone_id": "string",
  "token": "string"
}
```
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "id": 1,
  "type": "whatsapp",
  "status": "connected",
  "connected_at": "2024-01-01T00:00:00Z"
}
```

#### 4. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ Calendar
- **–ú–µ—Ç–æ–¥:** `POST`
- **URL:** `/integrations/calendar/`
- **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:**
```json
{
  "email": "string"
}
```
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "id": 1,
  "type": "calendar",
  "status": "connected",
  "connected_at": "2024-01-01T00:00:00Z"
}
```

#### 5. –í—ñ–¥–∫–ª—é—á–∏—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é
- **–ú–µ—Ç–æ–¥:** `DELETE`
- **URL:** `/integrations/{integrationId}/`
- **–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:** `200 OK` –∞–±–æ `204 No Content`

---

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

1. **–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫:**
   - `401 Unauthorized` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è—î —Ç–æ–∫–µ–Ω —ñ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–∞ `/login`
   - `ERR_NETWORK` –∞–±–æ `ERR_CONNECTION_REFUSED` - –∞–∫—Ç–∏–≤–∞—Ü—ñ—è –º–æ–∫-—Ä–µ–∂–∏–º—É (—è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∏–π)

2. **Mock Mode:**
   - –ê–∫—Ç–∏–≤—É—î—Ç—å—Å—è —è–∫—â–æ `VITE_MOCK_MODE=true` –∞–±–æ `VITE_API_URL` –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
   - –£ –º–æ–∫-—Ä–µ–∂–∏–º—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –∑ `localStorage`

3. **–§–∞–π–ª–∏:**
   - –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏: `.pdf, .doc, .docx, .txt, .xls, .xlsx`
   - –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ `multipart/form-data`

4. **–§–æ—Ç–æ:**
   - –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º—É —á–∞—Ç—ñ
   - –§–æ—Ä–º–∞—Ç: `multipart/form-data` –∑ –ø–æ–ª–µ–º `photo`

